<!doctype html>
<html lang="en-US" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tldr" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">TLDR | StatsHouse</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://github.com/statshouse/tldr"><meta data-rh="true" property="og:locale" content="en_US"><meta data-rh="true" property="og:locale:alternate" content="ru_RU"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="TLDR | StatsHouse"><meta data-rh="true" name="description" content="The main StatsHouse feature is the ability to &quot;digest&quot; as much data as you need and to display it in real time."><meta data-rh="true" property="og:description" content="The main StatsHouse feature is the ability to &quot;digest&quot; as much data as you need and to display it in real time."><link data-rh="true" rel="icon" href="/statshouse/img/statshouse.ico"><link data-rh="true" rel="canonical" href="https://github.com/statshouse/tldr"><link data-rh="true" rel="alternate" href="https://github.com/statshouse/tldr" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://github.com/statshouse/ru/tldr" hreflang="ru-RU"><link data-rh="true" rel="alternate" href="https://github.com/statshouse/tldr" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/statshouse/blog/rss.xml" title="StatsHouse RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/statshouse/blog/atom.xml" title="StatsHouse Atom Feed">



<link rel="preconnect" href="https://mc.yandex.ru">
<script>!function(e,t,a,c,n,r,i){e[n]=e[n]||function(){(e[n].a=e[n].a||[]).push(arguments)},e[n].l=1*new Date,r=t.createElement(a),i=t.getElementsByTagName(a)[0],r.async=1,r.src="https://mc.yandex.ru/metrika/tag.js",i.parentNode.insertBefore(r,i)}(window,document,"script",0,"ym"),ym(96098475,"init",{defer:!0,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0,ecommerce:!1,trackHash:!1})</script>
<noscript>
                            <div><img src="https://mc.yandex.ru/watch/96098475" style="position:absolute; left:-9999px;" alt=""></div>
                        </noscript><link rel="stylesheet" href="/statshouse/assets/css/styles.8b14ad53.css">
<script src="/statshouse/assets/js/runtime~main.005416d9.js" defer="defer"></script>
<script src="/statshouse/assets/js/main.d0f988b1.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/statshouse/"><div class="navbar__logo"><img src="/statshouse/img/statshouse.jpeg" alt="StatsHouse Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/statshouse/img/statshouse.jpeg" alt="StatsHouse Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">StatsHouse Docs</b></a><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div><a class="navbar__item navbar__link" href="/statshouse/blog">What&#x27;s new</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/statshouse/tldr" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">English</a></li><li><a href="/statshouse/ru/tldr" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ru-RU">Русский</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/VKCOM/statshouse" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/statshouse/">What is StatsHouse?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/statshouse/tldr">TLDR</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/statshouse/quick-start">Quick start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/statshouse/guides/access-cluster">User guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/statshouse/admin/sys-req">Administrator guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/statshouse/overview/features">Overview</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/statshouse/support">Support</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/statshouse/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">TLDR</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>TLDR</h1>
<p>The main StatsHouse feature is the ability to &quot;digest&quot; as much data as you need and to display it in real time.
It is possible due to <strong>aggregation</strong> and <strong>sampling</strong>: StatsHouse has to &quot;compress&quot; and (sometimes) to discard data.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>You can&#x27;t get rid of sampling in general. And most of the time you don&#x27;t need to.</p></div></div>
<p>To see whether StatsHouse suits you well, have a quick glance at its basic concepts and mechanisms. They are
described below — in a couple of words and pictures:</p>
<ul>
<li><a href="#aggregation">Aggregation</a></li>
<li><a href="#cardinality">Cardinality</a></li>
<li><a href="#sampling">Sampling</a>
<ul>
<li><a href="#statshouse-does-not-guarantee-the-absence-of-sampling">StatsHouse does not guarantee the absence of sampling</a></li>
<li><a href="#how-to-minimize-sampling">How to minimize sampling</a></li>
<li><a href="#things-that-do-not-minimize-sampling">Things that do not minimize sampling</a></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="aggregation">Aggregation<a href="#aggregation" class="hash-link" aria-label="Direct link to Aggregation" title="Direct link to Aggregation">​</a></h2>
<blockquote>
<p>Learn more about <a href="/statshouse/overview/concepts#aggregation"><strong>aggregation</strong></a> in the conceptual overview. This is just the
TLDR.</p>
</blockquote>
<p>StatsHouse &quot;collapses&quot; rows of data <strong>with the same tag values</strong>. The counters are summed up.</p>
<img src="/statshouse/assets/images/t-aggregation-28bf9a6a1d5c21fa08d1bed9d1897efb.png" width="800">
<p>StatsHouse does NOT store an exact metric value per each moment. It stores the general statistics (<em>aggregate</em> =
<em>count</em>, <em>sum</em>, <em>min</em>, <em>max</em>) for a time interval.</p>
<p>The maximum resolution is one second. Per-second data is available for two days, then the resolution decreases (to
minutes and hours).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cardinality">Cardinality<a href="#cardinality" class="hash-link" aria-label="Direct link to Cardinality" title="Direct link to Cardinality">​</a></h2>
<blockquote>
<p>Learn more about <a href="/statshouse/overview/concepts#cardinality"><strong>cardinality</strong></a> in the conceptual overview. This is just the
TLDR.</p>
</blockquote>
<p><em>High cardinality</em> data is data with many different tag values. It is poorly aggregated, takes up a lot of space —
StatsHouse has to sample it.</p>
<p><em>Low cardinality</em> data is aggregated (compressed) well, and StatsHouse usually does not have to sample it.</p>
<img src="/statshouse/assets/images/t-cardinality-7d6f434b222209f6156a8267f83d5dda.png" width="800">
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sampling">Sampling<a href="#sampling" class="hash-link" aria-label="Direct link to Sampling" title="Direct link to Sampling">​</a></h2>
<blockquote>
<p>Learn more about <a href="/statshouse/overview/concepts#sampling"><strong>sampling</strong></a> in the conceptual overview. This is just the TLDR.</p>
</blockquote>
<p>When the loads are too high, StatsHouse samples data — throws away random data <strong>rows</strong>. It multiplies the sums and
counts in the remaining rows by a sampling coefficient to preserve the average statistics.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><strong>StatsHouse does not guarantee the absence of sampling.</strong></p></div></div>
<img src="/statshouse/assets/images/t-sf-6098ac39708d8c43875f5c0764058a49.png" width="800">
<img src="/statshouse/assets/images/t-sf-result-788d31a5ee543894bc780176afbb4065.png" width="800">
<p>In most cases, users do not worry about sampling. And it still protects StatsHouse from overload.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="statshouse-does-not-guarantee-the-absence-of-sampling">StatsHouse does not guarantee the absence of sampling<a href="#statshouse-does-not-guarantee-the-absence-of-sampling" class="hash-link" aria-label="Direct link to StatsHouse does not guarantee the absence of sampling" title="Direct link to StatsHouse does not guarantee the absence of sampling">​</a></h3>
<p>You can&#x27;t get rid of sampling in general. StatsHouse is designed to be a communal cluster: the resource is shared
fairly between the tenants.</p>
<p>The tenant&#x27;s resource is the share of total resource. If the total resource has already been shared between the
tenants in your organization and there are no more new ones, the tenants&#x27; metrics will not interfere with each
other, so you can try to <a href="#how-to-minimize-sampling">minimize sampling</a>.</p>
<p>When scaling the system (adding new demanding tenants) the actual budget in bytes may decrease. In real
organizations, one should increase the total resource by scaling the physical cluster.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-minimize-sampling">How to minimize sampling<a href="#how-to-minimize-sampling" class="hash-link" aria-label="Direct link to How to minimize sampling" title="Direct link to How to minimize sampling">​</a></h3>
<p>StatsHouse samples data when you send more metric data than allowed. You can either decrease the amount of data sent
(1–3), or increase the budget (4).</p>
<ol>
<li><em>Minimize cardinality</em> —
<a href="/statshouse/guides/design-metric#how-many-tag-values">the number of tag values</a>.
It is not the number of tags that matters. The number of tag values is what you should care about.</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Do not use <code>userID</code> or <code>hostname</code> as tag values. Use larger categories.</p><p>Categorize users by a <em>region</em>, <em>platform</em>, etc. — not by their personal IDs.</p><p>Categorize hosts by a <em>datacenter</em>, a <em>cluster</em>, etc. — not by their names.</p></div></div>
<ol start="2">
<li><em>Consider the metric type</em> — it influences the amount of data sent:<!-- -->
<ul>
<li><a href="/statshouse/guides/design-metric#counters"><em>counter</em> metrics</a> takes up less space than
<a href="/statshouse/guides/design-metric#value-metrics"><em>value</em> metrics</a>;</li>
<li><a href="/statshouse/guides/edit-metrics#percentiles">enabling <em>percentiles</em></a> increases the amount of data sent — it may lead to
increased sampling.</li>
</ul>
</li>
<li><em>Reduce the metric resolution</em>. Learn <a href="/statshouse/guides/edit-metrics#resolution">how to customize resolution</a>.</li>
<li><em>Increase the budget</em>. Only administrators are allowed to <a href="/statshouse/admin/manage-budgets">manage budgets</a> for
specific metrics (as well as groups and namespaces). Use this option sparingly.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="things-that-do-not-minimize-sampling">Things that do not minimize sampling<a href="#things-that-do-not-minimize-sampling" class="hash-link" aria-label="Direct link to Things that do not minimize sampling" title="Direct link to Things that do not minimize sampling">​</a></h3>
<p>If you send a lot of rows and start writing less data to the same rows, the sampling rate will not reduce.</p>
<p>Imagine you send two data rows: <code>[a=1, b=2]</code> и <code>[a=1, b=3]</code> — they are different rows because they contain
different tag values. It does not matter if you write four values or one million values to these rows (it works for
<em>counter</em> and <em>value</em> types). But if your metric generates <strong>two million rows per second</strong>, they <strong>will likely be
sampled</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-statshouse-cannot-guarantee-the-absence-of-sampling">Why StatsHouse cannot guarantee the absence of sampling<a href="#why-statshouse-cannot-guarantee-the-absence-of-sampling" class="hash-link" aria-label="Direct link to Why StatsHouse cannot guarantee the absence of sampling" title="Direct link to Why StatsHouse cannot guarantee the absence of sampling">​</a></h3>
<p>You can&#x27;t get rid of sampling in general. StatsHouse is designed to work as a communal cluster: the resource is
fairly distributed among tenants.</p>
<p>The resource allocated to a tenant is the fixed percentage of the total resource.
If the resource in your organization has already been distributed among tenants and there are no new ones, then
tenants will not interfere with each other, and it is even possible to empirically <a href="#how-to-minimize-sampling">minimize sampling</a>.</p>
<p>Upon scaling (when new tenants appear), the actual budget in bytes may decrease. To solve this problem in the real
organization, one should increase the total budget, i.e., physically scale up the cluster.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/statshouse/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">What is StatsHouse?</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/statshouse/quick-start"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Quick start</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#aggregation" class="table-of-contents__link toc-highlight">Aggregation</a></li><li><a href="#cardinality" class="table-of-contents__link toc-highlight">Cardinality</a></li><li><a href="#sampling" class="table-of-contents__link toc-highlight">Sampling</a><ul><li><a href="#statshouse-does-not-guarantee-the-absence-of-sampling" class="table-of-contents__link toc-highlight">StatsHouse does not guarantee the absence of sampling</a></li><li><a href="#how-to-minimize-sampling" class="table-of-contents__link toc-highlight">How to minimize sampling</a></li><li><a href="#things-that-do-not-minimize-sampling" class="table-of-contents__link toc-highlight">Things that do not minimize sampling</a></li><li><a href="#why-statshouse-cannot-guarantee-the-absence-of-sampling" class="table-of-contents__link toc-highlight">Why StatsHouse cannot guarantee the absence of sampling</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 StatsHouse.</div></div></div></footer></div>
</body>
</html>