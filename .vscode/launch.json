{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "api",
            "type": "go",
            "request": "launch",
            "mode": "debug",
            "cwd": "${workspaceFolder}",
            "preLaunchTask": "clear_cache",
            "program": "${workspaceFolder}/cmd/statshouse-api/",
            "buildFlags": "-ldflags '-X github.com/vkcom/statshouse/internal/vkgo/build.trustedSubnetGroups=0.0.0.0/0'",
            "args": [
                "--verbose",
                "--local-mode",
                "--insecure-mode",
                "--access-log",
                "--clickhouse-v1-addrs=",
                "--clickhouse-v2-addrs=localhost:9000",
                "--listen-addr=:10888",
                "--metadata-addr=localhost:2442",
                "--statshouse-addr=localhost:13337",
                "--disk-cache=target/run/cache/api/mapping_cache.sqlite3",
                "--static-dir=statshouse-ui/build",
            ]
        },
        {
            "name": "debug 8000",
            "type": "go",
            "request": "attach",
            "mode": "remote",
            "port": 8000,
            "host": "127.0.0.1",
            "apiVersion": 2,
            "showLog": true,
        },
        {
            "name": "debug 8001",
            "type": "go",
            "request": "attach",
            "mode": "remote",
            "port": 8001,
            "host": "127.0.0.1",
            "apiVersion": 2,
            "showLog": true,
        },
        {
            "name": "agent",
            "type": "go",
            "request": "launch",
            "mode": "auto",
            "cwd": "${workspaceFolder}",
            "preLaunchTask": "clear_cache",
            "program": "${workspaceFolder}/cmd/statshouse/",
            "buildFlags": "-ldflags '-X github.com/vkcom/statshouse/internal/vkgo/build.trustedSubnetGroups=0.0.0.0/0'",
            "args": [
                "agent",
                "--cluster=test_shard_localhost",
                "--log-level=trace",
                "--agg-addr='localhost:13336,localhost:13336,localhost:13336'",
                "--cache-dir=target/run/cache/agent",
                "--remote-write-enabled",
                "--buffer-size-udp=524288000",
                "--cores-udp=2",
                "--listen-addr-ipv6=[::1]:13337",
            ],
        },
        {
            "name": "agent as root",
            "type": "go",
            "request": "launch",
            "mode": "exec",
            "asRoot": true,
            "console": "integratedTerminal",
            "program": "${fileDirname}/statshouse_debug",
            "preLaunchTask": "build_statshouse_debug",
            "args": [
                "agent",
                "--cluster=test_shard_localhost",
                "--log-level=trace",
                "--agg-addr='localhost:13336,localhost:13336,localhost:13336'",
                "--cache-dir=target/run/cache/agent",
                "--remote-write-enabled",
                "--buffer-size-udp=524288000",
                "-u=root",
                "-g=root",
            ],
        },
        {
            "name": "aggregator",
            "type": "go",
            "request": "launch",
            "mode": "auto",
            "cwd": "${workspaceFolder}",
            "preLaunchTask": "clear_cache",
            "program": "${workspaceFolder}/cmd/statshouse/",
            "buildFlags": "-ldflags '-X github.com/vkcom/statshouse/internal/vkgo/build.trustedSubnetGroups=0.0.0.0/0'",
            "args": [
                "aggregator",
                "--cluster=test_shard_localhost",
                "--log-level=trace",
                "--agg-addr=localhost:13336",
                "--kh=localhost:8123",
                "--metadata-addr=localhost:2442",
                "--auto-create",
                "--cache-dir=target/run/cache/aggregator",
            ],
        },
        {
            "name": "client test",
            "type": "go",
            "request": "launch",
            "mode": "auto",
            "cwd": "${workspaceFolder}",
            "program": "${workspaceFolder}/cmd/statshouse-client-test/",
            "args": [],
        },
        {
            "name": "proxy",
            "type": "go",
            "request": "launch",
            "mode": "auto",
            "cwd": "${workspaceFolder}",
            "program": "${workspaceFolder}/cmd/statshouse/",
            "buildFlags": "-ldflags '-X github.com/vkcom/statshouse/internal/vkgo/build.trustedSubnetGroups=0.0.0.0/0'",
            "args": [
                "ingress_proxy",
                "--ingress-version=2",
                "--hostname=ingress",
                "--cluster=default",
                "--agg-addr=127.0.0.1:13336,127.0.0.1:13346,127.0.0.1:13356",
                "--ingress-addr=127.0.0.1:13327",
                "--ingress-external-addr=127.0.0.1:13327",
                "--ingress-addr-ipv6=[::1]:13327",
                "--ingress-external-addr-ipv6=[::1]:13327",
                "--ingress-pwd-dir=${workspaceFolder}/localdebug/ingress_keys",
            ],
        },
    ]
}
