<!doctype html>
<html lang="ru-RU" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-guides/query-wth-promql" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Query with PromQL | StatsHouse</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://github.com/statshouse/ru/guides/query-wth-promql"><meta data-rh="true" property="og:locale" content="ru_RU"><meta data-rh="true" property="og:locale:alternate" content="en_US"><meta data-rh="true" name="docusaurus_locale" content="ru"><meta data-rh="true" name="docsearch:language" content="ru"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Query with PromQL | StatsHouse"><meta data-rh="true" name="description" content="This section tells you about using PromQL with StatsHouse:"><meta data-rh="true" property="og:description" content="This section tells you about using PromQL with StatsHouse:"><link data-rh="true" rel="icon" href="/statshouse/ru/img/statshouse.ico"><link data-rh="true" rel="canonical" href="https://github.com/statshouse/ru/guides/query-wth-promql"><link data-rh="true" rel="alternate" href="https://github.com/statshouse/guides/query-wth-promql" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://github.com/statshouse/ru/guides/query-wth-promql" hreflang="ru-RU"><link data-rh="true" rel="alternate" href="https://github.com/statshouse/guides/query-wth-promql" hreflang="x-default"><link rel="preconnect" href="https://mc.yandex.ru">
<script>!function(e,t,a,c,n,r,i){e[n]=e[n]||function(){(e[n].a=e[n].a||[]).push(arguments)},e[n].l=1*new Date,r=t.createElement(a),i=t.getElementsByTagName(a)[0],r.async=1,r.src="https://mc.yandex.ru/metrika/tag.js",i.parentNode.insertBefore(r,i)}(window,document,"script",0,"ym"),ym(96098475,"init",{defer:!0,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0,ecommerce:!1,trackHash:!1})</script>
<noscript>
                            <div><img src="https://mc.yandex.ru/watch/96098475" style="position:absolute; left:-9999px;" alt=""></div>
                        </noscript><link rel="stylesheet" href="/statshouse/ru/assets/css/styles.a17eb7a5.css">
<script src="/statshouse/ru/assets/js/runtime~main.972461f4.js" defer="defer"></script>
<script src="/statshouse/ru/assets/js/main.3dc6f218.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Перейти к основному содержимому"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Перейти к основному содержимому</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Переключить навигационную панель" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/statshouse/ru/"><div class="navbar__logo"><img src="/statshouse/ru/img/statshouse.jpeg" alt="StatsHouse Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/statshouse/ru/img/statshouse.jpeg" alt="StatsHouse Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Документация StatsHouse</b></a><div class="navbar__item dropdown dropdown--hoverable"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/statshouse/ru/guides/query-wth-promql"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>Русский</a><ul class="dropdown__menu"><li><a href="/statshouse/guides/query-wth-promql" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">English</a></li><li><a href="/statshouse/ru/guides/query-wth-promql" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ru-RU">Русский</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/VKCOM/statshouse" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Прокрутка к началу" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/statshouse/ru/">Что такое StatsHouse?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/statshouse/ru/quick-start">Краткое руководство</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/statshouse/ru/guides/access-cluster">Пользователям</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statshouse/ru/guides/access-cluster">Как получить доступ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statshouse/ru/guides/design-metric">Design your metric</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statshouse/ru/guides/create-metric">Create a metric</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statshouse/ru/guides/send-data">Send metric data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statshouse/ru/guides/view-graph">View metric data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statshouse/ru/guides/dashboards">Create and view dashboards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statshouse/ru/guides/edit-metrics">Edit a metric</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/statshouse/ru/guides/query-wth-promql">Query with PromQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/statshouse/ru/guides/openapi">Find OpenAPI specification</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/statshouse/ru/admin/sys-req">Администраторам</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/statshouse/ru/overview/features">Обзор</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/statshouse/ru/support">Поддержка</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Навигационная цепочка текущей страницы"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Главная страница" class="breadcrumbs__link" href="/statshouse/ru/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Пользователям</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Query with PromQL</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Содержание этой страницы</button></div><div class="theme-doc-markdown markdown"><h1>Query with PromQL</h1>
<p>This section tells you about using PromQL with StatsHouse:</p>
<ul>
<li><a href="/statshouse/ru/guides/query-wth-promql#what-is-promql">What is PromQL?</a></li>
<li><a href="/statshouse/ru/guides/query-wth-promql#how-to-switch-to-a-promql-query-editor">How to switch to a PromQL query editor</a></li>
<li><a href="/statshouse/ru/guides/query-wth-promql#what-is-specific-about-promql-in-statshouse">What is specific about PromQL in StatsHouse?</a>
<ul>
<li><a href="/statshouse/ru/guides/query-wth-promql#the-query-result-is-an-aggregate">The query result is an aggregate</a></li>
<li><a href="/statshouse/ru/guides/query-wth-promql#what-for-choosing-the-aggregate-components"><code>__what__</code> for choosing the aggregate components</a></li>
<li><a href="/statshouse/ru/guides/query-wth-promql#histograms-are-t-digests">Histograms are <em>t-digests</em></a></li>
<li><a href="/statshouse/ru/guides/query-wth-promql#no-data-grouping-by-default">No data grouping by default</a></li>
</ul>
</li>
<li><a href="/statshouse/ru/guides/query-wth-promql#promql-extensions-in-statshouse">PromQL extensions in StatsHouse</a>
<ul>
<li><a href="/statshouse/ru/guides/query-wth-promql#what-and-by"><code>__what__</code> and <code>__by__</code></a></li>
<li><a href="/statshouse/ru/guides/query-wth-promql#applying-dashboard-variables">Applying dashboard variables</a></li>
<li><a href="/statshouse/ru/guides/query-wth-promql#range-vectors-and-instant-vectors">Range vectors and instant vectors</a></li>
<li><a href="/statshouse/ru/guides/query-wth-promql#prefix-sum"><code>prefix_sum</code></a></li>
<li><a href="/statshouse/ru/guides/query-wth-promql#default"><code>default</code></a></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-promql">What is PromQL?<a class="hash-link" aria-label="Прямая ссылка на What is PromQL?" title="Прямая ссылка на What is PromQL?" href="/statshouse/ru/guides/query-wth-promql#what-is-promql">​</a></h2>
<p>PromQL is the Prometheus Query Language that lets the user select time series data.</p>
<p>Why have we decided to support querying with PromQL in StatsHouse?
We wanted to broaden the range of things the users could do with data in StatsHouse.
PromQL provides users with the necessary operations, it is widely used and well-documented.</p>
<p>Find the original <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/" target="_blank" rel="noopener noreferrer">PromQL documentation</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-switch-to-a-promql-query-editor">How to switch to a PromQL query editor<a class="hash-link" aria-label="Прямая ссылка на How to switch to a PromQL query editor" title="Прямая ссылка на How to switch to a PromQL query editor" href="/statshouse/ru/guides/query-wth-promql#how-to-switch-to-a-promql-query-editor">​</a></h2>
<p>To switch to the PromQL query editor in StatsHouse, press the <code>&lt; &gt;</code> button near the <em>Metric name</em> field.
Find more about the <a href="/statshouse/ru/guides/view-graph#18--promql-query-editor">PromQL query editor in the UI</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-specific-about-promql-in-statshouse">What is specific about PromQL in StatsHouse?<a class="hash-link" aria-label="Прямая ссылка на What is specific about PromQL in StatsHouse?" title="Прямая ссылка на What is specific about PromQL in StatsHouse?" href="/statshouse/ru/guides/query-wth-promql#what-is-specific-about-promql-in-statshouse">​</a></h2>
<p>If you have been using PromQL before, you may be confused with some PromQL implementation details in StatsHouse.
Let&#x27;s make them clear.</p>
<ul>
<li><a href="/statshouse/ru/guides/query-wth-promql#the-query-result-is-an-aggregate">The query result is an aggregate</a>—not an exact metric value per moment.</li>
<li>You can <a href="/statshouse/ru/guides/query-wth-promql#what-for-choosing-the-aggregate-components">choose the aggregate components</a> using the <code>__what__</code> selector.</li>
<li>StatsHouse <a href="/statshouse/ru/guides/query-wth-promql#histograms-are-t-digests">histograms are <em>t-digests</em></a>.</li>
<li>StatsHouse <a href="/statshouse/ru/guides/query-wth-promql#no-data-grouping-by-default">does not group data by default</a>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-query-result-is-an-aggregate">The query result is an aggregate<a class="hash-link" aria-label="Прямая ссылка на The query result is an aggregate" title="Прямая ссылка на The query result is an aggregate" href="/statshouse/ru/guides/query-wth-promql#the-query-result-is-an-aggregate">​</a></h3>
<p>Prometheus stores <code>timestamp—value</code> pairs. Instead, StatsHouse stores aggregated data per time intervals, or
<a href="/statshouse/ru/overview/concepts#%D0%B0%D0%B3%D1%80%D0%B5%D0%B3%D0%B0%D1%82"><em>aggregates</em></a>.</p>
<p>So, the query result in StatsHouse is an aggregate, and it depends on</p>
<ul>
<li>the <a href="/statshouse/ru/overview/concepts#%D0%BC%D0%B8%D0%BD%D0%B8%D0%BC%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%B2%D0%B0%D0%BB-%D0%B0%D0%B3%D1%80%D0%B5%D0%B3%D0%B0%D1%86%D0%B8%D0%B8-%D0%B8%D0%B7-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BD%D1%8B%D1%85"><em>minimal available aggregation interval</em></a>
(i.e., on the &quot;age&quot; of the data),</li>
<li>the <a href="/statshouse/ru/guides/view-graph#6--aggregation-interval"><em>requested aggregation interval</em></a>,</li>
<li>the metric <a href="/statshouse/ru/overview/concepts#%D1%80%D0%B0%D0%B7%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5"><em>resolution</em></a>.</li>
</ul>
<p>An <a href="/statshouse/ru/overview/concepts#%D0%B0%D0%B3%D1%80%D0%B5%D0%B3%D0%B0%D1%82">aggregate</a> contains the <em>count</em>, <em>sum</em>, <em>min</em>, <em>max</em>
statistics, and, optionally, the <a href="/statshouse/ru/overview/components#%D1%82%D0%B5%D0%B3-string-top-%D1%82%D0%BE%D0%BF-%D1%81%D1%82%D1%80%D0%BE%D0%BA"><em>String top</em></a> tag (<code>tag_s</code>)
and <a href="/statshouse/ru/guides/edit-metrics#percentiles">percentiles</a> (if enabled).
They are <em>aggregate components</em>:</p>
<table><thead><tr><th>timestamp</th><th>metric</th><th>tag_1</th><th>tag_2</th><th>tag_s</th><th>count</th><th>sum</th><th>min</th><th>max</th><th>percentiles</th></tr></thead><tbody><tr><td>13:45:05</td><td>toy_metric</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr></tbody></table>
<p>Read more about <a href="/statshouse/ru/overview/concepts#%D0%B0%D0%B3%D1%80%D0%B5%D0%B3%D0%B0%D1%86%D0%B8%D1%8F">aggregation</a> in StatsHouse.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-for-choosing-the-aggregate-components"><em><strong>what</strong></em> for choosing the aggregate components<a class="hash-link" aria-label="Прямая ссылка на what-for-choosing-the-aggregate-components" title="Прямая ссылка на what-for-choosing-the-aggregate-components" href="/statshouse/ru/guides/query-wth-promql#what-for-choosing-the-aggregate-components">​</a></h3>
<ul>
<li>In Prometheus, you can query the exact values. In Prometheus <code>timestamp—value</code> pairs, the
value is the floating-point number associated with a moment in time.</li>
<li>In StatsHouse, you can query the aggregates associated with time intervals.</li>
</ul>
<p>To query the aggregate components, use the  <code>__what__</code> selector. The possible values are:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;avg&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;count&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;countsec&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;max&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;min&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;sum&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;sumsec&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;stddev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;stdvar&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;p25&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;p50&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;p75&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;p90&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;p95&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;p99&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;p999&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;cardinality&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;cardinalitysec&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;unique&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;uniquesec&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>They are the <a href="/statshouse/ru/guides/view-graph#3--descriptive-statistics">descriptive statistics</a> you see in the StatsHouse UI.
The &quot;sec&quot; postfix means that the value is normalized—divided by the aggregation interval in seconds.</p>
<p>For example, this selector returns the counter for the <code>api_methods</code> metric associated with the aggregation interval:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">api_methods{__what__=&quot;count&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If the  <code>__what__</code> selector is not specified, StatsHouse tries to guess based on the PromQL functions you use in your
query:</p>
<table><thead><tr><th>PromQL functions</th><th>StatsHouse interpretation</th></tr></thead><tbody><tr><td>&quot;increase&quot;<br>&quot;irate&quot;<br>&quot;rate&quot;<br>&quot;resets&quot;</td><td><code>__what__=&quot;count&quot;</code></td></tr><tr><td>&quot;delta&quot;<br>&quot;deriv&quot;<br>&quot;holt_winters&quot;<br>&quot;idelta&quot;<br>&quot;predict_linear&quot;</td><td><code>__what__=&quot;avg&quot;</code></td></tr></tbody></table>
<p>For example, this query returns the <code>api_methods</code> metric&#x27;s counter rate for five minutes:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rate(api_methods[5m])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If StatsHouse fails to guess, it returns the counter for the <a href="/statshouse/ru/guides/design-metric#counters"><em>counter</em> metrics</a>
and the average (the sum divided by the counter) for the <a href="/statshouse/ru/guides/design-metric#value-metrics"><em>value</em> metrics</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="histograms-are-t-digests">Histograms are <em>t-digests</em><a class="hash-link" aria-label="Прямая ссылка на histograms-are-t-digests" title="Прямая ссылка на histograms-are-t-digests" href="/statshouse/ru/guides/query-wth-promql#histograms-are-t-digests">​</a></h3>
<p>Prometheus provides you with &quot;traditional&quot; and &quot;native&quot; histograms. StatsHouse now supports only the &quot;traditional&quot; ones.</p>
<p>StatsHouse stores histograms in the <em>t-digest</em> structure but does not provide them by default—you should
<a href="/statshouse/ru/guides/edit-metrics#percentiles">enable writing percentiles</a>.</p>
<p>To get access to percentiles (if enabled), specify the necessary one in the <code>__what__</code> selector:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;p25&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;p50&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;p75&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;p90&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;p95&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;p99&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;p999&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For example, this expression returns the 99th percentile:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">api_methods{__what__=&quot;p99&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Скопировать в буфер обмена" title="Скопировать" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-data-grouping-by-default">No data grouping by default<a class="hash-link" aria-label="Прямая ссылка на No data grouping by default" title="Прямая ссылка на No data grouping by default" href="/statshouse/ru/guides/query-wth-promql#no-data-grouping-by-default">​</a></h3>
<p>If you query data in Prometheus by a metric name, it returns all the data rows for this metric—all label combinations.</p>
<p>On the contrary, StatsHouse returns the result of aggregation. For example, in StatsHouse, the &quot;api_methods&quot; query
returns the single row.
To group data by tags, specify the necessary ones using the <code>__by__</code> PromQL operator.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="promql-extensions-in-statshouse">PromQL extensions in StatsHouse<a class="hash-link" aria-label="Прямая ссылка на PromQL extensions in StatsHouse" title="Прямая ссылка на PromQL extensions in StatsHouse" href="/statshouse/ru/guides/query-wth-promql#promql-extensions-in-statshouse">​</a></h2>
<p>Find PromQL extensions implemented in StatsHouse.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-and-by"><em><strong>what</strong></em> and <em><strong>by</strong></em><a class="hash-link" aria-label="Прямая ссылка на what-and-by" title="Прямая ссылка на what-and-by" href="/statshouse/ru/guides/query-wth-promql#what-and-by">​</a></h3>
<p>The <a href="/statshouse/ru/guides/query-wth-promql#what-for-choosing-the-aggregate-components"><code>__what__</code></a> and <a href="/statshouse/ru/guides/query-wth-promql#no-data-grouping-by-default"><code>__by__</code></a>
selectors help to express any standard query in StatsHouse.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="applying-dashboard-variables">Applying dashboard variables<a class="hash-link" aria-label="Прямая ссылка на Applying dashboard variables" title="Прямая ссылка на Applying dashboard variables" href="/statshouse/ru/guides/query-wth-promql#applying-dashboard-variables">​</a></h3>
<p>To bind the tag to the previously created variable in your PromQL query, use the following syntax:</p>
<p><code>tag_name:$variable_name</code></p>
<p>The resulting query may look like this:</p>
<p><code>topk(5,api_methods{@what=&quot;countsec&quot;,0:$env})</code></p>
<p>Find more about <a href="/statshouse/ru/guides/dashboards#set-up-promql-based-dashboards">setting up variables for PromQL-based graphs and dashboards</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="range-vectors-and-instant-vectors">Range vectors and instant vectors<a class="hash-link" aria-label="Прямая ссылка на Range vectors and instant vectors" title="Прямая ссылка на Range vectors and instant vectors" href="/statshouse/ru/guides/query-wth-promql#range-vectors-and-instant-vectors">​</a></h3>
<p>Functions for the range vectors receive instant vectors too. But the converse is false.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prefix-sum"><em>Prefix sum</em><a class="hash-link" aria-label="Прямая ссылка на prefix-sum" title="Прямая ссылка на prefix-sum" href="/statshouse/ru/guides/query-wth-promql#prefix-sum">​</a></h3>
<p>The <code>prefix_sum</code> function allows you to calculate a prefix sum. For example,
for a <code>1, 2, 3, 4, 5, 6</code> sequence, it returns the following: <code>1, 3, 6, 10, 15, 21</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="default"><em>default</em><a class="hash-link" aria-label="Прямая ссылка на default" title="Прямая ссылка на default" href="/statshouse/ru/guides/query-wth-promql#default">​</a></h3>
<p>It is a binary operator. It has an array on the left, and an array or a literal on the right.</p>
<ul>
<li>If it has the literal on the right, the <code>NaN</code> values on the left are replaced with the literal.</li>
<li>If it has the array on the right, the logic of mapping the arrays is the same as for the <code>or</code> operator. The <code>NaN</code>
values on the left are replaced with the corresponding values on the right.</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Страница документа"><a class="pagination-nav__link pagination-nav__link--prev" href="/statshouse/ru/guides/edit-metrics"><div class="pagination-nav__sublabel">Предыдущая страница</div><div class="pagination-nav__label">Edit a metric</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/statshouse/ru/guides/openapi"><div class="pagination-nav__sublabel">Следующая страница</div><div class="pagination-nav__label">Find OpenAPI specification</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/statshouse/ru/guides/query-wth-promql#what-is-promql">What is PromQL?</a></li><li><a class="table-of-contents__link toc-highlight" href="/statshouse/ru/guides/query-wth-promql#how-to-switch-to-a-promql-query-editor">How to switch to a PromQL query editor</a></li><li><a class="table-of-contents__link toc-highlight" href="/statshouse/ru/guides/query-wth-promql#what-is-specific-about-promql-in-statshouse">What is specific about PromQL in StatsHouse?</a><ul><li><a class="table-of-contents__link toc-highlight" href="/statshouse/ru/guides/query-wth-promql#the-query-result-is-an-aggregate">The query result is an aggregate</a></li><li><a class="table-of-contents__link toc-highlight" href="/statshouse/ru/guides/query-wth-promql#what-for-choosing-the-aggregate-components"><em><strong>what</strong></em> for choosing the aggregate components</a></li><li><a class="table-of-contents__link toc-highlight" href="/statshouse/ru/guides/query-wth-promql#histograms-are-t-digests">Histograms are <em>t-digests</em></a></li><li><a class="table-of-contents__link toc-highlight" href="/statshouse/ru/guides/query-wth-promql#no-data-grouping-by-default">No data grouping by default</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/statshouse/ru/guides/query-wth-promql#promql-extensions-in-statshouse">PromQL extensions in StatsHouse</a><ul><li><a class="table-of-contents__link toc-highlight" href="/statshouse/ru/guides/query-wth-promql#what-and-by"><em><strong>what</strong></em> and <em><strong>by</strong></em></a></li><li><a class="table-of-contents__link toc-highlight" href="/statshouse/ru/guides/query-wth-promql#applying-dashboard-variables">Applying dashboard variables</a></li><li><a class="table-of-contents__link toc-highlight" href="/statshouse/ru/guides/query-wth-promql#range-vectors-and-instant-vectors">Range vectors and instant vectors</a></li><li><a class="table-of-contents__link toc-highlight" href="/statshouse/ru/guides/query-wth-promql#prefix-sum"><em>Prefix sum</em></a></li><li><a class="table-of-contents__link toc-highlight" href="/statshouse/ru/guides/query-wth-promql#default"><em>default</em></a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© StatsHouse, 2024 г.</div></div></div></footer></div>
</body>
</html>