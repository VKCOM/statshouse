---
sidebar_position: 6
---

import EditStart from '../img/edit-start.png'
import EditSave from '../img/edit-save.png'
import EditView from '../img/edit-view.png'
import Description from '../img/description.png'
import AggregationEdit from '../img/aggregation-edit.png'
import EnablePercentiles from '../img/enable-percentiles.png'
import ResolutionEdit from '../img/resolution-edit.png'
import ResolutionView from '../img/resolution-view.png'
import Milliseconds from '../img/milliseconds.png'
import TagsN from '../img/tags-n.png'
import TagsDash from '../img/tag-dash.png'
import TagDesc from '../img/tag-desc.png'
import TagName from '../img/tag-name.png'
import RawValueComments from '../img/raw-value-comments.png'
import RawFormat from '../img/raw-format.png'
import StringTag from '../img/string-tag.png'
import Disable from '../img/disable.png'
import DraftTags from '../img/draft-tags.png'

# Как отредактировать метрику

Узнайте, [какие параметры метрики можно редактировать](#какие-параметры-метрики-можно-редактировать):

<!-- TOC -->
* [Описание (description)](#описание-description)
* [Тип метрики (aggregation)](#тип-метрики-aggregation)
  * [Перцентили (percentiles)](#перцентили-percentiles)
* [Разрешение (resolution)](#разрешение-resolution)
* [Единицы измерения (unit)](#единицы-измерения-unit)
* [Теги](#теги)
  * [Настройка отображения тегов](#настройка-отображения-тегов)
  * [Описание тегов](#описание-тегов)
  * [Настройка "сырых" (_Raw_) тегов](#настройка-сырых-raw-тегов)
    * [Комментарии](#комментарии)
    * [Формат "сырых" значений тегов](#формат-сырых-значений-тегов)
  * [Настройка тега _String top_](#настройка-тега-string-top)
  * [Драфт-теги](#драфт-теги)
* [Отключение метрики](#отключение-метрики)
* [Настройки для администраторов](#настройки-для-администраторов)
<!-- TOC -->

## Какие параметры метрики можно редактировать

Если вы уже отправляете данные в метрику, значит, необходимые параметры метрики настроены. Вы можете 
отредактировать дополнительные параметры метрики и настроить её отображение в интерфейсе:

<img src={EditStart} width="700"/>

Когда вы настроите всё, что хотели, прокрутите страницу вниз и сохраните изменения:

<img src={EditSave} width="800"/>

Чтобы просмотреть отредактированную метрику, вернитесь наверх:

<img src={EditView} width="800"/>

## Описание (description)

Метрику можно дополнить описанием в одну или несколько строк — оно отобразится в интерфейсе. Форматирование пока не 
поддерживается.

<img src={Description} width="800"/>

[Название графика](view-graph.md#2--название-графика) можно отредактировать на странице просмотра графика — оно 
отобразится и на дашборде. При этом название исходной метрики не меняется. 
[Переименовать саму метрику нельзя](create-metric.md#можно-ли-переименовать-метрику).

## Тип метрики (aggregation)

[Тип метрики](design-metric.md#типы-метрик) влияет на то, какие описательные статистики доступны и имеют смысл для 
метрики. В [меню](view-graph.md#3--описательные-статистики) могут отображаться статистики, не соответствующие типу 
вашей метрики. Если выбрать нерелевантную статистику, значения на графике будут равны нулю.
Например, накопленные значения нельзя посмотреть для типа _unique_.

Чтобы в меню не отображались такие статистики, укажите тип метрики:

<img src={AggregationEdit} width="500"/>

Тип _Mixed_ позволяет отображать в интерфейсе все виды статистик (даже нерелевантные).
Узнайте больше о том, [как сочатаются типы метрик](design-metric.md#как-сочетаются-типы-метрик).

### Перцентили (percentiles)

Перцентили доступны только для _value_-метрик:

<img src={EnablePercentiles} width="500"/>

:::note
Перцентили для метрики начинают записываться только после включения _Enable percentiles_.
Для ранее записанных данных перцентили не отображаются.
:::

Обратите внимание: запись перцентилей увеличивает объём данных — это может привести к 
усилению [семплирования](../overview/concepts.md#семплирование).
Если для вас важно минимизировать семплирование, следите за тем, чтобы [кардинальность](view-graph.md#cardinality) 
вашей метрики была минимальной, или уменьшите её [разрешение](edit-metrics.md#разрешение-resolution).

## Разрешение (resolution)

Максимальное разрешение, с которым можно отобразить данные на графике, зависит от того, какие
[агрегаты](../overview/concepts.md#агрегация) доступны в данные момент:
* данные, агрегированные по секундам, хранятся в течение первых двух дней,
* данные, агрегированные по минутам, хранятся в течение месяца,
* данные, агрегированные по часам, хранятся как угодно долго (или до тех пор, пока их не удалят вручную).

Так, посекундные данные можно получить в течение двух последних дней,
поминутные данные доступны за последний месяц, часовые данные — за любой период.

Если для вас не так важно получать данные с максимальным разрешением, однако важно минимизировать 
[семплирование](../overview/concepts.md#семплирование), уменьшите разрешение метрики.
Например, вы можете выбрать такое разрешение, чтобы [агент](../overview/components.md#агент) отправлял данные раз в 15 
секунд, а не раз в секунду:

<img src={ResolutionEdit} width="400"/>

Разрешение, равное 1, 5, 15 или 60 секундам, помечено как "нативное". Рекомендуем использовать эти значения, чтобы 
избежать дрожания на графике (они соответствуют уровням детализации (LOD) в интерфейсе). Узнайте больше о 
[разрешении](../overview/concepts.md#разрешение).

Пользовательское разрешение отображается рядом с названием метрики:

<img src={ResolutionView} width="600"/>

:::important
Настройка разрешения влияет на обработку данных, а не на их отображение в интерфейсе.
Невозможно отобразить данные с [интервалом агрегации](view-graph.md#6--интервал-агрегации) меньшим, чем пользовательское разрешение:
вы не сможете посмотреть посекундные данные, если разрешение равно 5 секундам.
:::

## Единицы измерения (unit)

Для _value_-метрики можно указать единицы измерения. Они появятся на подписи к оси Y.

Например, если вы установите _milliseconds_ (миллисекунды) для метрики, на оси Y можно будет увидеть секунды, минуты 
и даже дни:

<img src={Milliseconds} width="900"/>

:::note
Если вы просматриваете метрику-счётчик (_counter_) или выбираете статистики _count_ и _count/sec_, не 
указывайте единицы измерения. Счётчик подразумевает подсчёт числа событий, т.е. отвечает на вопрос "сколько?". Нужно 
оставить вариант _no unit_.
:::

## Теги

Вы можете настроить то, как теги будут отображаться в интерфейсе и как будут обрабатываться данные, к которым эти теги 
относятся.

### Настройка отображения тегов

Ненужные теги можно скрыть, если, например, вы используете менее 16 тегов в метрике:

<img src={TagsN} width="250"/>

Чтобы скрыть один из тегов в середине списка, поставьте дефис (-) в поле описания (_Tag description_) этого тега:

<img src={TagsDash} width="500"/>

### Описание тегов

Отправляя данные, вы ссылаетесь на теги, используя идентификаторы либо системные или пользовательские имена тегов 
(алиасы). Прежде чем упоминать алиас при отправке данных, настройте его:

<img src={TagName} width="170"/>

Можно дополнить тег описанием, которое будет отображаться в интерфейсе:

<img src={TagDesc} width="600"/>

### Настройка "сырых" (_Raw_) тегов

Если вам нужны теги с большим количеством значений, которые являются 32-битными числами (например, тег `user_ID`), 
используйте [_Raw_ теги](design-metric.md#сырые-raw-теги), чтобы избежать ошибок 
[mapping flood](../overview/components.md#бюджет-на-создание-значений-тегов).

Чтобы не забыть, что означают "сырые" значения тегов, укажите [формат](#формат-сырых-значений-тегов), 
который будет отображаться в интерфейсе, и добавьте [комментарии](#комментарии).

#### Комментарии

Комментарии помогают вспомнить, что означают "сырые" значения тегов:

<img src={RawValueComments} width="1000"/>

:::note
Комментарии хранятся как метаинформация, поэтому не расходуют бюджет маппинга.
:::

#### Формат "сырых" значений тегов

"Сырые" значения тегов отправляются как 32-битные целочисленные значения. 
Например, вы отправляете целые числа, которые являются метками времени. Чтобы сделать отображение таких значений более 
понятным, выберите для них формат:

<img src={RawFormat} width="1000"/>

:::note
Обратите внимание: в качестве "сырых" значений нужно отправлять только 32-битные целочисленные значения. Если вам 
нужно отправлять IP-адреса, отправляйте `1234567890`, а не `12.345.67.890` (такой адрес отправится как строка).
Если в качестве формате выбрать _ip_, StatsHouse отобразит "сырое" значение, например `1234567890`, как
`12.345.67.890`, т.е. IP-адрес.
:::

### Настройка тега _String top_

Чтобы отфильтровать данные на графике с помощью тега [String top](design-metric.md#тег-string-top-топ-строк), 
дайте ему имя или добавьте описание:

<img src={StringTag} width="600"/>

### Драфт-теги

Система создаёт драфт-теги, когда в отправляемых вами данных содержатся названия тегов, которые 
ещё не были сопоставлены с идентификаторами, и поэтому система о них "не знает".

Эта функциональность помогает при [переходе с Prometheus](../admin/migrating.md#как-перейти-с-prometheus).
При скрейпинге метрик теги извлекаются автоматически. В полученной Prometheus-метрике может быть более 16 тегов
(т. е. названий тегов), и StatsHouse "не знает", как сопоставить их с идентификаторами.

StatsHouse извлекает "неизвестные" названия тегов из метрик и отображает их как драфт-теги. Пользователь может вручную 
сопоставить их с идентификаторами:

<img src={DraftTags} width="700"/>

:::tip
Драфт-теги также создаются, когда вы ссылаетесь на теги в коде, используя алиасы, хотя предварительно 
не [настраивали их в интерфейсе](#описание-тегов). Функциональность драфт-тегов помогает быстрее 
настраивать теги.
:::

Узнайте больше о том, [как спроектировать теги для метрики](design-metric.md#теги).

## Отключение метрики

Метрику нельзя удалить, но можно отключить:

<img src={Disable} width="250"/>

Если метрика отключена, запись данных в неё прекращается.
Эта метрика перестаёт отображаться в общем списке.

:::important
Чтобы включить метрику обратно, необходима прямая ссылка на неё.
:::

## Настройки для администраторов

Следующие настройки предназначены только для администраторов:

* _Weight_
* _Mapping Flood Counter_
* _Presort key_
* _Presort key only_
* _Enable max host_
* _Enable min host_
* _Enable sum square_


