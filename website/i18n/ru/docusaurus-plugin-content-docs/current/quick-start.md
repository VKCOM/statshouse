---
sidebar_position: 3
---

import DemoFlow from './img/demo-flow.png'
import CreateMetric from './img/create-metric.png'
import MyMetric from './img/quick-start-name-metric.png'
import ViewMetric from './img/quick-start-view.png'
import BasicViewOptions from './img/basic-viewing-options.png'
import TimePeriod from './img/time-period.png'
import TimeAgo from './img/time-ago.png'
import AggregationInterval from './img/aggregation-interval.png'
import TopN from './img/top-n.png'

# Краткое руководство

Познакомьтесь с системой StatsHouse за 10 минут. Вот инструкция:

<img src={DemoFlow} width="900"/>

Вам помогут эти разделы:
<!-- TOC -->
* [Получите доступ](#получите-доступ)
* [Запустите StatsHouse локально](#запустите-statshouse-локально)
* [Отправьте данные с демосервера](#отправьте-данные-с-демосервера)
* [Создайте свою метрику](#создайте-свою-метрику)
* [Отправьте данные в свою метрику](#отправьте-данные-в-свою-метрику)
* [Что посмотреть на графике](#что-посмотреть-на-графике)
<!-- TOC -->

:::important
Это руководство работает для систем на основе Linux.
В macOS или Windows могут возникнуть проблемы с Docker.
:::

Как создавать метрики, отправлять и просматривать данные: читайте в 
[руководстве пользователя](introduction.md#пользователям).

## Получите доступ

Если в вашей организации уже есть инсталляция StatsHouse, обратитесь за доступом к администраторам.

## Запустите StatsHouse локально

:::important
Убедитесь, что у вас установлен [Docker](https://docs.docker.com/get-docker/).
:::

Если в вашей организации ещё нет своей инсталляции StatsHouse, установите систему локально.
Клонируйте репозиторий StatsHouse, перейдите в директорию с таким же названием и запустите установщик:

```shell
git clone https://github.com/VKCOM/statshouse
cd statshouse
./localrun.sh
```

Интерфейс StatsHouse откроется, как только завершится установка.

## Отправьте данные с демосервера

Убедитесь, что находитесь в директории StatsHouse. Запустите 
[демонстрационный веб-сервер](https://github.com/VKCOM/statshouse/blob/master/cmd/statshouse-example/statshouse-example.go) (написан на Go).
Он отправит данные демонстрационных метрик в вашу локальную инсталляцию.

 ```shell
 go run ./cmd/statshouse-example/statshouse-example.go
 ```

## Создайте свою метрику

Откройте основное меню (значок **⚡** слева вверху) и выберите **Create metric**:

<img src={CreateMetric} width="300"/>

Дайте метрике название:

<img src={MyMetric} width="600"/>

Узнайте больше о том, [как создавать метрики](guides/create-metric.md).

## Отправьте данные в свою метрику

Отправьте данные с помощью _bash_-скрипта:

```bash
echo '{"metrics":[{"name":"my_metric","tags":{},"counter":1000}]}' | nc -q 1 -u 127.0.0.1 13337
```

Узнайте больше о том, [как устроены метрики в StatsHouse](guides/design-metric.md#что-представляют-собой-метрики-в-statshouse) и 
[как ещё можно отправлять метрики](guides/send-data.md).

Отправленные данные отобразятся на дашборде по адресу 
[localhost:10888](http://localhost:10888/view?live=1&f=-300&t=0&tn=-1&s=example_response_time&t1.s=example_response_time&t1.qw=avg&t2.s=example_runtime_memory&t2.qw=avg&t2.qb=key1).

В этом примере мы отправили одни и те же данные трижды:

<img src={ViewMetric} width="900"/>

Узнайте больше о том, [как пользоваться графиками](guides/view-graph.md).

## Что посмотреть на графике

Основные параметры графиков — на этом скриншоте и в описаниях:

<img src={BasicViewOptions} width="900"/>

### Название метрики

Найти метрику можно по названию. Узнайте больше о том, 
[как найти нужную метрику и как не испортить чужую метрику](guides/view-graph.md#1--название-метрики). 

### Описательные статистики

Это статистические функции, которые количественно описывают или обобщают данные.
Можно показать на графике одну или несколько статистик. Вот самые распространённые из них:
* _count_ и _count/sec_,
* _sum_ и _sum/sec_,
* _average_,
* _standard deviation_,
* _minimum_ и _maximum_.

Описательных статистик в StatsHouse [довольно много](guides/view-graph.md#3--описательные-статистики).
Можно ли применять их к данным вашей метрики?
[Зависит от типа метрики.](guides/design-metric.md#типы-метрик)
Например, статистика _percentiles_ (_перцентили_) применима только к типу _value_.

В меню могут отображаться статистики, не соответствующие типу вашей метрики. Если выбрать нерелевантную 
статистику, значения на графике будут равны нулю. Чтобы в меню не отображались такие статистики,
[укажите тип метрики в разделе редактирования метрики](guides/edit-metrics.md#тип-метрики-aggregation).

:::tip
Если вы выбрали _count_ или _sum_ в качестве статистики,
а для [интервала агрегации](#интервал-агрегации) установлено значение _Auto_, график может быть сложно 
интерпретировать.

Лучше выбрать _count/sec_ или _sum/sec_.
Вы получите нормализованные данные, которые не зависят от интервала агрегации.
:::

Узнайте больше об [описательных статистиках](guides/view-graph.md#3--описательные-статистики).

### Период времени

Просматривайте данные за конкретный период времени: последние пять минут, последний час, последнюю неделю. 
Даже за последние два года.

Можно выбрать конкретную дату и время. А ещё настройки можно комбинировать: например, так
отобразятся данные за последний час для предыдущего дня:

<img src={TimePeriod} width="500"/>

Данные за определённый период времени можно сравнить с данными за аналогичный период в прошлом: на день, неделю или год 
раньше.

<img src={TimeAgo} width="300"/>

Настраивая период времени, обращайте внимание на то, какой [интервал агрегации](#интервал-агрегации) у вас выбран.

:::tip
Убедитесь, что период времени больше, чем интервал агрегации: например, период времени равен семи дням, а 
интервал агрегации — 24 часам.
:::

Чтобы просматривать данные в режиме реального времени, используйте [Live mode](guides/view-graph.md#5--live-mode).

### Интервал агрегации

Интервал [агрегации](overview/concepts.md#агрегация) — это что-то вроде степени детализации для вашей метрики. Чем 
больше интервал агрегации, тем более сглаженным выглядит график:

<img src={AggregationInterval} width="600"/>

:::tip
Если выбрать значение _Auto_, для отображения данных на графике будет использоваться 
[_минимальный интервал агрегации из доступных_](overview/concepts.md#минимальный-доступный-интервал-агрегации).
Он изменчив, поскольку зависит от того, какие данные доступны в данный момент:
* данные, агрегированные по секундам, хранятся в течение первых двух дней,
* данные, агрегированные по минутам, хранятся в течение месяца,
* данные, агрегированные по часам, хранятся как угодно долго.

Доступный интервал агрегации также связан с [разрешением](overview/concepts.md#разрешение) метрики.
:::

Узнайте больше об [агрегации](overview/concepts.md#агрегация) в StatsHouse и о том, как менять
[разрешение](guides/edit-metrics.md#разрешение-resolution) метрики.

### Теги

Теги помогают учитывать дополнительные характеристики данных, влияющие факторы или контекст. С помощью тегов 
можно фильтровать и группировать данные.

Например, данные можно пометить как относящиеся к
* окружению: `production`, `development`, или `staging`;
* частям приложения: `video`, `stories`, `feed`, и т.п.;
* платформе: `mobile`, `web`, и т.п.,
* группе методов, версии, чему угодно ещё.

:::tip
Бывают теги с большим числом разнообразных значений. Например, вам может быть нужен тег "идентификатор 
пользователя". Такие теги могут вызывать ошибки типа ["mapping flood"](guides/view-graph.md#mapping-status) 
или увеличивать [семплирование](guides/view-graph.md#sampling) из-за высокой 
[кардинальности](overview/concepts.md#кардинальность).
Если вам всё равно нужны такие теги, почитайте
[о них подробнее](guides/design-metric.md#сколько-значений-тегов-можно-использовать).
:::

Узнайте больше о том, [как фильтровать данные с помощью тегов](guides/view-graph.md#7--теги),
[как их настраивать](guides/design-metric.md#теги) 
и [редактировать](guides/edit-metrics.md#теги), а также о том, что такое 
[кардинальность](overview/concepts.md#кардинальность).

### Top N

Когда вы группируете данные по одному или нескольким тегам, например, по `environment` и `platform`,
значения тегов могут образовывать много комбинаций:

| Environment × Platform | `web` | `iphone` | `android` |
|:----------------------:|:-----:|:--------:|:--------:|
|      `production`      |  ✔️   |    ✔️    |    ✔️    |
|       `staging`        |  ✔️   |    ✔️    |    ✔️    |
|       `testing`        |  ✔️   |    ✔️    |    ✔️    |

Если комбинаций слишком много, используйте параметр _Top N_: укажите, сколько комбинаций с максимальными значениями 
нужно показать на графике.

Если выбрать значение _Top 3_ для этого параметра в нашем примере, получится вот что:

<img src={TopN} width="900"/>

:::note
Чтобы узнать обо всех возможностях StatsHouse, изучите [руководство пользователя](introduction.md#пользователям).
:::
