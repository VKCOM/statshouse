---
sidebar_position: 5
title: Безопасность подключений
---

import Aes from '../img/aes.png'
import NoProxyEncryption from '../img/no-proxy-encryption.png'
import WithProxyEncryption from '../img/with-proxy-encryption.png'

# Безопасность подключений

StatsHouse шифрует данные между агентом и агрегатором, даже если они расположены в одном и том же
датацентре. По умолчанию используется AES-шифрование.

<img src={Aes} width="700"/>

Если ваш кластер получает данные от агентов, которые находятся за пределами защищённого периметра (вне 
датацентра), используйте прокси. У прокси есть свой набор ключей шифрования для внешних соединений.

Общую информацию о [прокси](../overview/components.md#прокси) можно найти в обзоре
компонентов StatsHouse.

## Без использования прокси

Вот как шифруются данные между агентом и агрегатором, когда прокси не используется:

<img src={NoProxyEncryption} width="300"/>

Агенты отправляют зашифрованные данные агрегаторам.
Они используют ключ из директории `--aes-pwd-file`.

Агрегаторы расшифровывают входящие данные.
Они используют тот же ключ из директории `--aes-pwd-file`.

## С использованием прокси

Вот как шифруются данные между агентом и агрегатором, когда между ними установлен прокси:

<img src={WithProxyEncryption} width="600"/>

Агенты отправляют зашифрованные данные на прокси.
Каждый агент получает в качестве параметра `-aes-pwd-file` один из ключей, содержащихся в директории 
`-ingress-pwd-dir` у прокси.

Прокси расшифровывают входящие данные, используя ключи из директории `--ingress-pwd-dir`.

Прокси отправляют зашифрованные данные на агрегаторы.
Для шифрования исходящего трафика они используют ключ из директории `--aes-pwd-file`.

Агрегатор запускается с параметром `--aes-pwd-file` (для расшифровки входящего трафика).
