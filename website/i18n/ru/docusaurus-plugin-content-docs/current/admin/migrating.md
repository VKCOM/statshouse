---
sidebar_position: 9
title: Переход с других систем
---

# Переход с других систем

Вы можете перейти на StatsHouse с других систем мониторинга, таких как Grafana и Prometheus.

Узнайте больше о [преимуществах](../overview/features.md) StatsHouse.

## Как перейти с Grafana

Изначально StatsHouse предоставлял пользователям
[плагин (источник данных) для Grafana](https://github.com/VKCOM/statshouse/tree/master/grafana-plugin-ui). Мы прекратили
разработку плагина — сейчас мы направляем все усилия на развитие собственной системы визуализации в StatsHouse.

Чтобы пользователям было проще перейти на StatsHouse, мы работаем над виджетами, отображением пороговых 
значений, улучшенным представлением таблиц, отображением нескольких метрик на одном графике и другими функциями.

Чтобы обсудить расширение функциональности или наш план разработки, обратитесь к разделу
[Поддержка](../support.md).

## Как перейти с Prometheus

Системы Prometheus и StatsHouse различаются во многом:

| Система    | Модель данных                                                                             | Как работает                                                                                                                                | Push или pull |
|------------|-------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|---------------|
| Prometheus | хранит данные в виде [временных рядов](https://prometheus.io/docs/concepts/data_model/)   | использует _скрейпинг_: собирает данные от источников, [обходя](https://prometheus.io/docs/prometheus/latest/getting_started/) конечные точки | pull          |
| StatsHouse | хранит данные в виде [агрегатов](../overview/concepts.md#агрегат)                         | приложения отправляют данные в агенты StatsHouse, агенты агрегируют данные и передают их дальше в систему                                   | push          |

Как совместить эти две системы? В StatsHouse разработан прототип, который позволяет собирать метрики почти так, как это 
делает Prometheus.

:::info
Пользовательский интерфейс для Prometheus-совместимого режима находится в стадии разработки.
:::

Прототип описан ниже.

### _Push_ и _pull_: как совместить

Чтобы совместить модели StatsHouse и Prometheus, мы используем следующий механизм:

> Агент StatsHouse нужно установить на каждую машину, с которой вы хотите получать метрики. Агенты будут собирать
> данные со своих машин, используя
> [конфигурационный файл (как в Prometheus)](https://prometheus.io/docs/prometheus/latest/configuration/configuration/).

### Конфигурационный файл

Конфигурационный файл для скрейпинга метрик в StatsHouse похож на
[конфигурационный файл Prometheus](https://prometheus.io/docs/prometheus/latest/configuration/configuration/).
Однако у него есть дополнительные поля, такие как [неймспейс](#сбор-метрик-в-неймспейс), который 
формирует пространство для собираемых метрик, и некоторые другие.

### Сбор метрик в неймспейс

В Prometheus-совместимом режиме StatsHouse собирает метрики только в [явно указанный](#конфигурационный-файл) 
неймспейс. StatsHouse не знает, какой объём данных он получит при скрейпинге, поэтому ему приходится 
контролировать бюджет.

Если вы попытаетесь собрать метрики в общий неймспейс, вы получите ошибку `err_metric_not_found` 
(см. метрику `__src_ingestion_status` и тег `status`).

### Как создавать метрики (при скрейпинге)

Если неймспейс указан в конфигурационном файле, StatsHouse _автоматически_ создаст метрики в этом неймспейсе. Если вы 
попытаетесь собрать данные в общий неймспейс, метрики не будут созданы (появится ошибка `err_metric_not_found`).

### Как создавать теги (при скрейпинге)

При скрейпинге метрик теги извлекаются _автоматически_. В полученной Prometheus-метрике может быть более 16 тегов (т.
е. названий тегов), и StatsHouse "не знает", как сопоставить их с идентификаторами.

Эти извлечённые теги появляются в качестве "черновых" тегов — см. раздел [Edit](../guides/edit-metrics.md) для 
конкретной метрики. Узнайте, как вручную
[сопоставить извлечённые названия тегов с идентификаторами тегов в StatsHouse](../guides/edit-metrics.md#map-the-draft-tag-names-to-the-tag-ids).

### Форматы метрик: как сопоставить

Основные [типы метрик в Prometheus](https://prometheus.io/docs/concepts/metric_types/) и
[типы метрик в StatsHouse](../guides/design-metric.md#metric-types) также различаются. Мы
сопоставили их таким образом:

| Prometheus                                                                              | StatsHouse                                                                          |
|-----------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|
| counter →<br/>([cumulative](https://prometheus.io/docs/concepts/metric_types/#counter))  | counter<br/>([an aggregate per time interval](../guides/design-metric.md#counters)) |
| gauge                                                                                 → | value                                                                               |
| histogram                                                                             → | histogram (_experimental_)                                                          |

Более подробную информацию о скрейпинге метрик мы предоставим позже.
